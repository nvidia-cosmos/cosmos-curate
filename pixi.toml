[workspace]
channels = ["conda-forge", "nvidia"]
name = "cosmos-curate"
platforms = ["linux-64"]
version = "1.0.0"

[pypi-options]
extra-index-urls = ["https://pypi.nvidia.com"]

[dependencies]
python = "3.10.*"

[pypi-dependencies]
ray = { version = "==2.48.0", extras = ["default"] } # conda-forge package pulls in an old version of protobuf

[feature.core.system-requirements]
cuda = "12.9.1" # match the version of the nvidia/cuda docker base image

[feature.core.dependencies]
astral = "*"
attrs = "*"
azure-identity = "*"
azure-storage-blob = "*"
cattrs = "*"
easydict = "*"
fastapi = "*"
gpustat = "*"
huggingface_hub = "*"
jinja2 = "*"
loguru = "*"
numpy = "*"
nvtx = "*"
pandas = "*"
psycopg2-binary = "*"
pynvml = "*"
pyproj = "*"
pytest = "*"
pytest-asyncio = "*"
pytest-cov = "*"
pytest-xdist = "*"
pytorch-gpu = ">=2.7.1"
scipy = "*"
sqlalchemy = "*"
tabulate = "*"
tenacity = "*"
timezonefinder = "*"
tqdm = "*"
transformers = "*"
typer = "*"
uvicorn = "*"
webdataset = "*"

[feature.core.pypi-dependencies]
av = "*" # conda-forge package pulls in ffmpeg
ngcsdk = "*" # not available on conda-forge
opencv-python-headless = "*" # not available on conda-forge
pillow = "*"  # required by phi-4 model, part of task, needs to be serialized
pulp = "*" # conda-forge package is too old

[feature.model-download.dependencies]
azure-identity = "*"
azure-storage-blob = "*"
cattrs = "*"
huggingface_hub = "*"
loguru = "*"
pandas = "*"
pynvml = "*"
numpy = "*"
scipy = "*"
tabulate = "*"

[feature.model-download.pypi-dependencies]
ngcsdk = "*" # not available on conda-forge
opencv-python-headless = "*" # not available on conda-forge

[feature.phi.system-requirements]
cuda = "12.9.1" # match the version of the nvidia/cuda docker base image

[feature.phi.dependencies]
attrs = "*"
azure-identity = "*"
azure-storage-blob = "*"
cattrs = "*"
flash-attn = "*"
loguru = "*"
nvtx = "*"
numpy = "*"
pandas = "*"
pynvml = "*"
pytorch-gpu = ">=2.7.1"
scipy = "*"
tabulate = "*"

[feature.phi.pypi-dependencies]
av = "*" # conda-forge package pulls in ffmpeg
accelerate = "*"
backoff = "*"
ngcsdk = "*" # not available on conda-forge
opencv-python-headless = "*" # not available on conda-forge
peft = "==0.13.2"
pillow = "*"
pulp = "*" # conda-forge package is too old
setuptools = "*"
timm = "*" # conda-forge package pulls in torchvision, which is behind
transformers = "==4.51.3"

[feature.text-curator.system-requirements]
cuda = "12.9.1" # match the version of the nvidia/cuda docker base image

[feature.text-curator.dependencies]
cattrs = "*"
easydict = "*"
loguru = "*"
numpy = "<2"
pytorch-gpu = ">=2.7.1"
tabulate = "*"
webdataset = "*"

[feature.text-curator.pypi-dependencies]
av = "*" # conda-forge package pulls in ffmpeg
nemo-curator = { git = "https://github.com/NVIDIA/NeMo-Curator.git", rev = "060d702d0e5289abb1e94a92f9b8296b36c04fb7", extras = ["cuda12x", "s3", "azure"] }
opencv-python-headless = "*" # not available on conda-forge
ngcsdk = "*" # not available on conda-forge
pulp = "*" # conda-forge package is too old

[feature.unified.dependencies]
cuda-libraries-dev = "*"
flash-attn = "*"
flash-attn-fused-dense = "*"
flash-attn-layer-norm = "*"

[feature.unified.pypi-dependencies]
timm = "*" # conda-forge package pulls in torchvision, which is behind
vllm = ">=0.10.0" # not available on conda-forge

[feature.video-splitting.dependencies]
pycuda = "*"

[feature.video-splitting.pypi-dependencies]
cvcuda-cu12 = "*" # not available on conda-forge
PyNvVideoCodec = "*" # not available on conda-forge
timm = "*" # conda-forge package pulls in torchvision, which is behind

[feature.pip.dependencies]
pip = "*"

[environments]
default = ["default", "core"]
model-download = ["model-download"]
phi = ["default", "phi"]
paddle-ocr = ["core", "pip"]
text-curator = ["text-curator"]
transformers = ["core"]
unified = ["core", "unified"]
video-splitting = ["core", "video-splitting"]
